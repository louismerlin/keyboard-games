<!DOCTYPE html>
<html>

<head>
    <title>Welcome to Vue</title>
    <script src="https://unpkg.com/vue/dist/vue.js"></script>
</head>
<style>
    body {
        font-family: "medium", Helvetica, sans-serif;
        background-color: black;
    }

    h1 {
        font-size: 100px;
        text-align: center;
        color: #00a9e0;
    }

    p {
        text-align: center;
        color: white;
    }
</style>

<body>
    <div id="app">
        <h1 v-on:keyup="sendKey">
          SWAGBOARD
        </h1>
        <p>{{ message }}</p>
    </div>

    <script>
        function get(theUrl, callback) {
            var xmlHttp = new XMLHttpRequest();
            xmlHttp.onreadystatechange = function() {
                if (xmlHttp.readyState == 4 && xmlHttp.status == 200)
                    callback(xmlHttp.responseText);
            }
            xmlHttp.open("GET", theUrl, true); // true for asynchronous
            xmlHttp.send(null);
        }

        function post(url, data, callback) {
            var xmlHttp = new XMLHttpRequest();
            xmlHttp.onreadystatechange = function() {
                if (xmlHttp.readyState == 4 && xmlHttp.status == 200)
                    callback(xmlHttp.responseText);
            }
            xmlHttp.open("POST", url, true);
            xmlHttp.setRequestHeader("Content-Type", "application/json");
            xmlHttp.send(data);
        }

        var app = new Vue({
            el: '#app',
            data: {
                message: 'Want to play a game ?',
                inGame: false,
            },
            methods: {
                getGreetings: function() {
                    get("http://localhost:5000", function(status) {
                        if (status == 1) {
                            app.message = "Player 1 wins!";
                            app.color = 'red';
                            app.inGame = false;
                        }
                        if (status == 2) {
                            app.message = "Player 2 wins!";
                            app.color = 'green';
                            app.inGame = false;
                        }
                        if (status == 0) {
                            app.message = "That's a tie";
                        }
                        if (status == -1) {
                            app.message = "Want to play a game ?";
                            app.inGame = false;
                        }
                    })
                },
                sendKey: function(e) {
                    post("http://localhost:5000/key", JSON.stringify({
                        k: e.key
                    }), function(e) {
                        //console.log(e);
                    })
                },
                startGame: function(e) {
                  app.inGame = true;
                    if (e.key == "t")
                        post("http://localhost:5000/start", JSON.stringify({
                            g: 0
                        }), function(e) {

                        });
                    if (e.key == "s")
                        post("http://localhost:5000/start", JSON.stringify({
                            g: 1
                        }), function(e) {

                        });
                }
            },
            created() {
                setInterval(function() {
                    app.getGreetings();
                }, 1000 / 1);
                addEventListener("keyup", function(e) {
                    app.sendKey(e)
                    if (!app.inGame) app.startGame(e);
                });
            }
        })
    </script>
</body>

</html>
